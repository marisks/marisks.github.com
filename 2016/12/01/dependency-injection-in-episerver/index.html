<!DOCTYPE html><!--if lt IE 8html.no-js.lt-ie9.lt-ie8(lang="en")--><!--if IE 8html.no-js.lt-ie9(lang="en")--><!--if gt IE 8html.no-js(lang="en")--><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Dependency injection in EPiServer | marisks # code</title><meta name="description" content="The concept of a dependency injection is simple - pass a dependent object in your object to use it. But that is not the only concept involved and some of the used concepts are better than others. In the EPiServer world, several patterns are used and misused."><meta name="keywords" content=".NET, ASP.NET, C#, JavaScript, Optimizely, EPiServer, programming languages"><meta name="viewport" content="width=device-width, initial-scale=1"><!--Place favicon.ico and apple-touch-icon.png in the root directory--><meta name="generator" content="DocPad v6.79.4" /><!-- Google Tag Manager--><script async src="https://www.googletagmanager.com/gtag/js?id=G-540M01NJGH"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-540M01NJGH');</script><!-- End Google Tag Manager--><link rel="icon" sizes="16x16 32x32" href="/favicon.ico?v=1"><link  rel="stylesheet" href="/css/vendor/normalize.css" /><link  rel="stylesheet" href="/css/vendor/main.css" /><link  rel="stylesheet" href="/css/vendor/bootstrap.min.css" /><link  rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" /><link  rel="stylesheet" href="/css/style.css" /><script src="/js/vendor/modernizr-2.6.2.min.js"></script></head><body><!-- Google Tag Manager--><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WDKMR7" height="0" width="0" style="display: none; visibility: hidden;"></iframe></noscript><!-- End Google Tag Manager--><!--if lt IE 8p.browsehappy
    |You are using an
    strong
        |outdated browser
    |. Please
    a(href="http://browsehappy.com/")
        |upgrade your browser
    |to improve your experience.
--><div id="wrap"><div role="navigation" class="navbar navbar-ornament navbar-fixed-top"><div class="container"><div class="navbar-header"><a href="/" class="navbar-brand">marisks # code</a></div></div></div><div class="container"><div class="row"><div class="col-sm-8"><article><header><h1>Dependency injection in EPiServer</h1><p class="meta"><time datetime="2016-12-01T00:00:00.000Z">Thu Dec 01 2016</time></p></header><div class="lead"><p>The concept of <a href="https://en.wikipedia.org/wiki/Dependency_injection">a dependency injection</a> is simple - pass a dependent object in your object to use it. But that is not the only concept involved and some of the used concepts are better than others. In the EPiServer world, several patterns are used and misused.</p>

</div><h1 id="service-locator">Service locator</h1>
<p>One of the concepts which sometimes is mistakenly perceived as a kind of dependency injection is <a href="https://en.wikipedia.org/wiki/Service_locator_pattern">Service locator</a>. But it is not and it is even an <a href="http://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern/">anti-pattern</a>. The main issue with <em>Service locator</em> is that it hides dependencies.</p>
<p>Unfortunately, it is widely used in <em>EPiServer</em> development. Many developers use service locator instead of using dependency injection. I also have used service locator in examples on this blog. Also, service locator often is used in the scheduled jobs, extension methods and other places where it is not possible to inject dependent object.</p>
<h1 id="constructor-and-method-injection">Constructor and method injection</h1>
<p><a href="https://en.wikipedia.org/wiki/Dependency_injection#Constructor_injection">Constructor injection</a> is the most used type of the dependency injection. The dependent object is injected as a constructor parameter.</p>
<p>Method injection is similar to the constructor injection but the dependent object is injected into the method which uses that object.</p>
<p>Both patterns are the most appropriate way to do dependency injection. But unfortunately, it is not always possible. While you are able to design your classes so that those use a constructor injection or a method injection, many framework dependent classes can&#39;t be designed that way.</p>
<p><em>EPiServer</em> supports constructor injection for controllers. It is possible to inject dependent objects in your <em>EPiServer</em> controllers if you have <a href="http://world.episerver.com/documentation/Items/Developers-Guide/Episerver-CMS/9/Initialization/dependency-injection/">configured it properly</a> - created <em>MVC</em> dependency resolver.</p>
<p>While dependency injection support for controllers is great, <em>EPiServer</em> has other types of infrastructure which don&#39;t support it. For example, scheduled jobs and initialization modules do not support constructor injection. Instead, you have to use service locator or property injection.</p>
<h1 id="property-injection">Property injection</h1>
<p><a href="https://jeremybytes.blogspot.com/2014/01/dependency-injection-property-injection.html">Property injection</a> or <a href="https://en.wikipedia.org/wiki/Dependency_injection#Setter_injection">setter injection</a> is the type of dependency injection when a dependent object is injected into the already constructed object via a property or special setter method. This method allows injecting dependencies into the object which can&#39;t have a constructor with parameters.</p>
<p><em>EPiServer</em> has support for property injection via <a href="http://world.episerver.com/documentation/Class-library/?documentId=cms/10/1692DF76">Injected&lt;T&gt;</a> class. The service you would like to inject should be <em>wrapped</em> as a type parameter of the <em>Injected&lt;T&gt;</em> class and defined as a property on your class. Then during the object construction or after construction via containers <em>BuildUp</em> method it populates property values. If it is not possible, then it uses a service locator to lazily load the object. This scenario is quite common when your properties are private and/or static.</p>
<p>There are several issues with this approach. First of all, your object depends on the <em>Injected&lt;T&gt;</em> class which is not related to your class problem domain. Another issue is with commonly accepted pattern to make these properties private. This way dependency is hidden and works like service locator which as you know is an anti-pattern.</p>
<p>Instead of using <em>Injected&lt;T&gt;</em>, I would like to see <em>EPiServer</em> to add support for constructor injection via overridable factories.</p>
<h1 id="composition-root">Composition root</h1>
<p><a href="http://blog.ploeh.dk/2011/07/28/CompositionRoot/">Composition root</a> is a single point in the application where whole object graph gets constructed. In <em>ASP.NET MVC</em> application usually, it is custom a <em>IControllerFactory</em>. When developing applications with <em>EPiServer</em> it is not common to use a custom <em>IControllerFactory</em>. Also, it is missing composition roots for scheduled job, an initialization module, and other infrastructure code creation.</p>
<p>It is possible to create object graph manually (<a href="http://blog.ploeh.dk/2014/06/10/pure-di/">Pure DI</a>) in the composition root but usually some kind of <em>DI Container</em> is used. <em>EPiServer</em> uses <a href="http://structuremap.github.io/">StructureMap</a> under the hood but recently implemented their own <a href="http://world.episerver.com/documentation/Items/Developers-Guide/Episerver-CMS/9/Initialization/dependency-injection">explicit service registration API</a>. I do not like this because it hides the power of the DI container. For example, <em>StructureMap</em> has <a href="http://structuremap.github.io/registration/registry-dsl/">registries</a> which allow splitting registration logic into separate modules. It also has convention based service registration while <em>EPiServer</em> doesn&#39;t support it.</p>
<p>I think that <em>EPiServer</em> should not re-implement registration API but instead allow to register their internal services using any DI container. And application developers should still use their DI container API.</p>
<p>Another way to register services in <em>EPiServer</em> is <a href="http://world.episerver.com/documentation/Items/Developers-Guide/Episerver-CMS/9/Initialization/dependency-injection">implicit service registration</a>. While at first, it seems really simple solution it is a quite dangerous one and should not be used widely. There are several reasons why it is dangerous.</p>
<p>First of all, it hides service registration so that you can&#39;t see explicitly in the registration code that something is registered. For example, if there is some service with implicit registration in a referenced library and you want to register your service which implements the same interface. Then you might get into a situation when both registrations conflict and then it is hard to find why. One of my colleagues had such issue and spent several hours solving it.</p>
<p>Another issue is that during the development of the service you do not know what lifetime it should run in. It is the decision of the composition
and should be handled in the composition root. For example, you might set the service to be a singleton and also inject some other services in your class. But you do not know the lifetime of those other services. If injected services are transient (per request), then you might get odd behavior as only the instance of first time created injected service will be used.</p>
<h1 id="summary">Summary</h1>
<p><em>EPiServer</em> has gone into the right direction by supporting dependency injection but it still requires some improvements and revise some ambiguous implementations. I would like to see <em>EPiServer</em> to go to most simple solutions when adding support for dependency injection - like factories for different types of framework part composition.</p>
</article><div id="disqus_thread"></div><script>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'marisksblog'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a><a href="http://disqus.com" class="dsq-brlink">comments powered by<span class="logo-disqus">Disqus</span></a></noscript></div><div class="col-sm-1"><aside class="archive"><ul class="nav"><li><a href="/">2021</a></li><li><a href="/2020/">2020</a></li><li><a href="/2019/">2019</a></li><li><a href="/2018/">2018</a></li><li><a href="/2017/">2017</a></li><li class="active"><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li></ul></aside></div><div class="col-sm-3"><aside class="panel panel-default"><div class="panel-body"><div class="about"><img src="/img/common/profile_0021.jpg" alt="profile picture" class="center-block img-responsive thumbnail"><p>Hi! I'm Māris Krivtežs. I am Web developer primarily working with ASP.NET, EPiServer and front-end development at&nbsp;<a href="http://geta.no" target="_blank">Geta</a>, but same time learning different programming languages, learning new programming paradigms, architectures, and design. I spend my free time with my family, reading books, bicycling and traveling.</p></div><ul class="social"><li><a href="http://stackoverflow.com/users/660154/marisks" target="_blank"><i class="fa fa-stack-overflow"></i></a></li><li><a href="https://github.com/marisks" target="_blank"><i class="fa fa-github-alt"></i></a></li><li><a href="https://twitter.com/pioners1001" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="http://www.linkedin.com/pub/maris-krivtezs/31/98b/b53" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="/rss.xml" target="_blank"><i class="fa fa-rss"></i></a></li></ul><a href="https://getadigital.com" target="_blank"><img src="/img/common/ident-geta-wordmark.svg" alt="Geta logo" class="center-block img-responsive aside-logo"></a></div></aside></div></div></div></div><div id="footer"><div class="container"><div class="container credit">Copyright &copy; 2017 Maris Krivtezs. All Rights Reserved, except for the parts enumerated below:<ul class="licence-list"><li>- The source code examples on this blog are covered by&nbsp;<a href="https://opensource.org/licenses/mit-license.php">MIT License</a>.</li><li>- This page content, excluding the visual design and the logotype, is covered by&nbsp;<a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</li></ul></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.10.2.min.js"><\/script>')</script><script  src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script><script  src="/js/plugins.js"></script><script  src="/js/main.js"></script></body>